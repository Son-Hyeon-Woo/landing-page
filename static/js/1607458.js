(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1908:function(t,e,i){"use strict";var a=i(16),n=i(11),o=i(2),r=i(3),s=i(12),l=i(8),d=i(4),p=i(9),c=(i(40),i(119),i(75),i(57),i(29),i(33),i(37),i(17),i(50),i(15),i(83),i(30),i(368),i(19),i(34)),u=i(13),h=i(36),v=i(85),f=i(78),g=i(0),y=i(10);function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function _callSuper(t,e,i){return e=Object(l.a)(e),Object(s.a)(t,_isNativeReflectConstruct()?Reflect.construct(e,i||[],Object(l.a)(t).constructor):e.apply(t,i))}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}var m,__decorate=function(t,e,i,a){var n,o=arguments.length,r=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"===("undefined"==typeof Reflect?"undefined":Object(p.a)(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,a);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":Object(p.a)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(t){function AbstractAppElementComponent(){var t;return Object(o.a)(this,AbstractAppElementComponent),(t=_callSuper(this,AbstractAppElementComponent,arguments)).appEditStore=Object(v.default)(t.$pinia),t.appHistoryStore=Object(f.b)(t.$pinia),t.isDragHovered=!1,t.dragEnteredCount=0,t.dragMousePositionBefore=null,t.stopDragScroll=!0,t.onScroll=function(){t.appEditStore.isDragging&&t.initRect()},t.isChildOfGroup=function(e){var i=t.getUpperBlock();if(i)return!i.childs.some((function(t){return t.id===e}))},t}return Object(d.a)(AbstractAppElementComponent,t),Object(r.a)(AbstractAppElementComponent,[{key:"backgroundImageStyle",get:function get(){return{width:"100%",height:"100%","background-image":this.data.styles["background-image"],"background-size":this.data.styles["background-size"],opacity:this.data.styles["background-opacity"],"background-position":"center 0","background-repeat":"no-repeat"}}},{key:"backgroundVideoStyle",get:function get(){return{width:"100%",height:"100%",opacity:this.data.styles["background-opacity"],"object-fit":"cover"}}},{key:"position",get:function get(){var t,e;return null!=(null===(e=null===(t=this.data)||void 0===t?void 0:t.styles)||void 0===e?void 0:e.position)?this.data.styles.position:this.data.positionFixed&&this.data.positionFixed.isActivated?"fixed":"absolute"}},{key:"sizeStyle",get:function get(){var t={};return"relative"==this.position&&this.data.type==y.a.AppText?(null!=this.data.w&&(t.width="".concat(this.data.w,"px")),null!=this.data.h&&(t["min-height"]="".concat(this.data.h,"px"))):(null!=this.data.w&&(t.width="".concat(this.data.w,"px")),null!=this.data.h&&(t.height="".concat(this.data.h,"px"))),t}},{key:"metadata",get:function get(){return h.default.instantiateMetadataByType(this.data.type)}},{key:"totalStyle",get:function get(){var t,e=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},this.sizeStyle),null===this||void 0===this?void 0:this.positionStyle),this.data.styles),{},{"background-image":null,"background-size":null,"background-position":null,"background-repeat":null,"background-opacity":null});return this.editable&&(e["animation-fill-mode"]="backwards"),(null===(t=this.data.metadata)||void 0===t?void 0:t.animationStyles)&&(e=_objectSpread(_objectSpread({},this.data.metadata.animationStyles),e)),this.data.hide&&(e.display="none !important"),"relative"==this.position&&("100%"==e.width&&(e.width="auto"),"100%"==e.height&&(e.height="auto")),e}},{key:"classes",get:function get(){var t,e,i=[];(null===(t=this.data.metadata)||void 0===t?void 0:t.animationClasses)&&(i=Object(a.a)(Object.keys(this.data.metadata.animationClasses)));var n=null!==(e=this.data.metadata)&&void 0!==e?e:{},o=n.isActivated,r=n.isHovered,s=n.isElementTreeItemHovered,l=this.editable&&this.hoverable&&1===this.appEditStore.scale;return this.editable?(s||l)&&(o||i.push("hoverable"),(this.isDragHovered||r||s)&&i.push("hovered")):s&&(o||i.push("hoverable"),i.push("hovered")),i}},{key:"parentElement",get:function get(){return this.parents[0]}},{key:"isRootElement",get:function get(){var t=this.appEditStore.page.datas.page;return this.data.id===t.id}},{key:"isInRootElement",get:function get(){return this.parents[0]===this.appEditStore.page.datas.page}},{key:"isInBlockElement",get:function get(){var t;return(null===(t=this.parentElement)||void 0===t?void 0:t.type)===y.a.AppBlock}},{key:"isLowerElement",get:function get(){return this.parents.some((function(t){return![y.a.AppPage,y.a.AppBlock].includes(t.type)}))}},{key:"isParentActivated",get:function get(){var t,e;return null===(e=null===(t=this.parentElement)||void 0===t?void 0:t.metadata)||void 0===e?void 0:e.isActivated}},{key:"mouseright",value:function mouseright(t){var e=g.MenuItems,i=Object(a.a)(e);if(this.copiable)if(this.data.type===y.a.AppBlock){var n=e.filter((function(t){return"sendToBack"!=t&&"bringToFront"!=t&&"show/hide"!=t&&"group"!=t&&"ungroup"!=t&&"lock/unlock"!=t}));this.appEditStore.setMenuItems(n)}else this.appEditStore.setMenuItems(e);else i=e.filter((function(t){return"copy"!=t&&"lock/unlock"!=t&&"show/hide"!=t})),this.appEditStore.setMenuItems(i);this.appEditStore.setMenuPosition({x:t.pageX,y:t.pageY}),this.appEditStore.setMenuOpened(!this.appEditStore.isMenuOpened),this.appEditStore.isMenuOpened&&(this.appEditStore.setIsMultipleActivate(!0),this.onActivated(!0,t),this.appEditStore.setIsMultipleActivate(!1)),this.propagationEvent||t.stopPropagation(),window.addEventListener("contextmenu",(function(t){t.preventDefault()}),{capture:!1,once:!0,passive:!1})}},{key:"mouseenter",value:function mouseenter(t){var e=this;this.editable&&this.appEditStore.setMeta((function(){e.data.metadata.isHovered=!0}))}},{key:"mouseleave",value:function mouseleave(t){var e=this;this.editable&&this.appEditStore.setMeta((function(){e.data.metadata.isHovered=!1}))}},{key:"dragenter",value:function dragenter(t){this.editable&&this.droppable&&(this.dragEnteredCount++,this.isDragHovered=!0)}},{key:"dragleave",value:function dragleave(t){this.editable&&this.droppable&&(this.dragEnteredCount--,this.dragEnteredCount=Math.max(0,this.dragEnteredCount),this.dragEnteredCount<=0&&(this.isDragHovered=!1))}},{key:"dragover",value:function dragover(t){t.preventDefault()}},{key:"drop",value:function drop(t){if(this.editable){try{if(null!=t.dataTransfer){var e=t.clientX,i=t.clientY,a=this.$el.getBoundingClientRect(),n=(a.height,a.width,a.x),o=a.y,r=JSON.parse(t.dataTransfer.getData("params")),s=h.default.instantiateClassByName(r.type,r);if(s)s.x=e-n,s.y=i-o,"function"==typeof this.onDropped?this.onDropped({element:s}):(this.appEditStore.addElement({parent:this.data,target:s,addPageHistory:!1}),this.appHistoryStore.endSaveHistory())}}catch(t){console.log(t)}this.dragEnteredCount=0,this.isDragHovered=!1,this.propagationEvent||t.stopPropagation(),t.preventDefault()}}},{key:"onMouseDown",value:function onMouseDown(t){var e,i,a=this.getIsSiblingActivated();if(this.isLowerElement&&a)null===(e=null==t?void 0:t.stopPropagation)||void 0===e||e.call(t);else if(!this.isRootElement&&!this.isLowerElement){var n,o=this.data.metadata.isActivated,r=(this.isInRootElement||this.isInBlockElement)&&((n=this.parents[0]).type===y.a.AppBlock?n.metadata.isFocused:n.metadata.isActivated);(o||r)&&(this.appEditStore.isMenuOpened&&this.appEditStore.setMenuOpened(!1),this.updateActivateElement(t),this.$emit("mousedown",t),this.propagationEvent||null===(i=null==t?void 0:t.stopPropagation)||void 0===i||i.call(t),this.dragMousePositionBefore={x:null==t?void 0:t.clientX,y:null==t?void 0:t.clientY})}}},{key:"onClick",value:function onClick(t){var e;this.editable&&this.$emit("click",t),this.propagationEvent||null===(e=null==t?void 0:t.stopPropagation)||void 0===e||e.call(t)}},{key:"onMouseUp",value:function onMouseUp(){if(this.dragMousePositionBefore=null,this.appEditStore.isDragging){this.appEditStore.dropTo({isChangeParentBlock:!this.isChildOfGroup(this.data.id)});this.appEditStore.activated.map((function(t){return t.element}));this.appHistoryStore.endSaveHistory()}}},{key:"onWindowMouseUp",value:function onWindowMouseUp(){this.appEditStore.isDragging&&this.onMouseUp()}},{key:"onDoubleClick",value:function onDoubleClick(t){var e,i,a=this;this.activateLowerElement(t,(function(){a.$emit("dblclick",t)}))&&(null===(e=null==t?void 0:t.stopPropagation)||void 0===e||e.call(t)),this.propagationEvent||null===(i=null==t?void 0:t.stopPropagation)||void 0===i||i.call(t)}},{key:"onActivated",value:function onActivated(t,e,i){var a=this;if(t){if(1!==this.appEditStore.scale){this.appEditStore.setScale(1);var n=this.data;this.$nextTick((function(){Object(u.D)(n,{block:"nearest"})}))}this.$emit("activated")}else this.$emit("deactivated"),this.appEditStore.setMenuOpened(!1),this.appEditStore.setGuidePosition({x:null,y:null});t&&this.appEditStore.activated.find((function(t){return t.element==a.data}))||(t?this.appEditStore.addActivated({clearAll:!!(null==i?void 0:i.clearAll),element:this.data,metadata:this.data.metadata,focusBlock:!!(null==i?void 0:i.clearAll)&&this.getUpperBlock()}):this.appEditStore.removeActivated(this.data))}},{key:"activateElement",value:function activateElement(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{force:!1},a=i.force,n={},o=this.data.type===y.a.AppBlock,r=this.getUpperBlock(),s=null===(e=null==r?void 0:r.metadata)||void 0===e?void 0:e.isFocused;if(!o&&s&&((null==t?void 0:t.shiftKey)||this.appEditStore.isMultipleActivate)||(n.clearAll=!0),a)this.onActivated(!0,t,n);else{if(this.isLowerElement&&!this.isInRootElement&&!this.isParentActivated)return;this.onActivated(!0,t,n)}}},{key:"activateLowerElement",value:function activateLowerElement(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=!1;return this.isRootElement||(!(null==t?void 0:t.shiftKey)&&this.data.metadata.isActivated?(null==e||e(),i=!0):i=this.updateActivateElement(t)),i}},{key:"updateActivateElement",value:function updateActivateElement(t){var e,i=!1;if(this.data.metadata.isActivated){if((null==t?void 0:t.shiftKey)&&this.draggable){var a=this.getUpperBlock();this.onActivated(!1,t),a&&!((null===(e=this.appEditStore.activated)||void 0===e?void 0:e.length)>=1)&&this.appEditStore.addActivated({clearAll:!1,element:a,metadata:a.metadata}),i=!0}}else{var n=!(null==t?void 0:t.shiftKey)&&!this.appEditStore.isMultipleActivate,o=this.parentElement,r=this.isLowerElement,s=this.getIsSiblingActivated();if(r){if(!this.data.metadata.isActivated&&o){if(r&&s)this.activateElement(t,{force:!0});else if(o.metadata.isActivated)this.activateElement(t);else if(o){var l=this.getUpperBlock();this.appEditStore.addActivated({clearAll:n,element:o,metadata:o.metadata,focusBlock:l})}i=!0}}else this.activateElement(t),i=!0}return i}},{key:"initRect",value:function initRect(){if(this.data&&this.data.metadata&&this.$el&&null!=this.$el.getBoundingClientRect&&this.editable){var t=this.$el.getBoundingClientRect();this.appEditStore.setMetaData({target:this.data.metadata,key:"rectX",value:Object(u.H)(t.x,2)}),this.appEditStore.setMetaData({target:this.data.metadata,key:"rectY",value:Object(u.H)(t.y,2)}),this.appEditStore.setMetaData({target:this.data.metadata,key:"rectW",value:Object(u.H)(t.width,2)}),this.appEditStore.setMetaData({target:this.data.metadata,key:"rectH",value:Object(u.H)(t.height,2)})}}},{key:"getIsSiblingActivated",value:function getIsSiblingActivated(){var t=this.parents[0],e=this.appEditStore.activated;return Array.isArray(null==t?void 0:t.childs)&&t.childs.some((function(t){return e.some((function(e){return e.element===t}))}))}},{key:"getUpperBlock",value:function getUpperBlock(){var t,e,i,a=null===(i=null===(e=(t=this.parents).slice)||void 0===e?void 0:e.call(t,-2))||void 0===i?void 0:i[0];return(null==a?void 0:a.type)===y.a.AppBlock?a:void 0}},{key:"mounted",value:function mounted(){(this.initRect(),this.editable)&&(window.addEventListener("mouseup",this.onWindowMouseUp),document.querySelector("#AppPageContainerWrapper").addEventListener("scroll",this.onScroll))}},{key:"updated",value:function updated(){this.editable&&this.initRect()}},{key:"unmounted",value:function unmounted(){var t;if(this.editable){var e=document.querySelector("#AppPageContainerWrapper");null===(t=null==e?void 0:e.removeEventListener)||void 0===t||t.call(e,"scroll",this.onScroll),window.removeEventListener("mouseup",this.onWindowMouseUp)}}}])}(c.Vue);__decorate([Object(c.Prop)({required:!0}),__metadata("design:type","function"==typeof(m=void 0!==h.default&&h.default)?m:Object)],b.prototype,"data",void 0),__decorate([Object(c.Prop)({default:function _default(){return[]}}),__metadata("design:type",Array)],b.prototype,"parents",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!1}),__metadata("design:type",Boolean)],b.prototype,"editable",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!0}),__metadata("design:type",Boolean)],b.prototype,"draggable",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!0}),__metadata("design:type",Boolean)],b.prototype,"hoverable",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!1}),__metadata("design:type",Boolean)],b.prototype,"droppable",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!0}),__metadata("design:type",Boolean)],b.prototype,"copiable",void 0),__decorate([Object(c.Prop)({type:Boolean,default:!1}),__metadata("design:type",Boolean)],b.prototype,"propagationEvent",void 0);var E=b=__decorate([Object(c.Component)({})],b),k=i(64),S=Object(k.a)(E,undefined,undefined,!1,null,null,null);e.a=S.exports}}]);